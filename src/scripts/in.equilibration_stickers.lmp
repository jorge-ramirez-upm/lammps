# HOW TO RUN:
# lmp.exe -v F [DAT FILE WITHOUT equilibrated.dat] -i [LAMMPS SCRIPT] -v M [# matrix chains]
# lmp.exe -v F .\Tr4_200_10_8N1000NC9rho0.85 -i .\in.production.rod.springs -v M 9

echo            none

units           lj
atom_style      bond
# Definitely needed for bond creation
#special_bonds   fene extra 10
special_bonds fene

boundary        p p p

variable poff equal ${pon}/${keq}
log $Fpon${pon}Keq${keq}.log

print       "*****************************************************"
print       "Reading Configuration file... $F.equilibrated.dat"
print       "*****************************************************"
read_data       $F.equilibrated.lammpsdat extra/special/per/atom 10 extra/bond/per/atom 2

#neighbor        0.6 multi
neighbor        0.6 bin
neigh_modify    every 1 delay 1 check yes
comm_modify     vel yes
# I think it is necessary for bond creation
comm_modify cutoff 4.0

bond_style      fene
bond_coeff      1 30.0 1.5 1.0 1.0  # Original Kremer-Grest
bond_coeff      2 30.0 1.5 1.0 1.0  # Original Kremer-Grest

print           ""
print       "*****************************************************"
print       "PRODUCTION: Full LJ (WCA) potential, t=1e9 tau"
print       "*****************************************************"
pair_style lj/cut 1.122462048 
pair_modify     shift yes
pair_coeff  * * 1.0 1.0 1.122462048

fix 1 all nve
fix         2 all langevin 1.0 1.0 2.0 48279 zero yes # Remove box COM motion by random force

# Calculation of pressure tensor and correlations
#variable pxy equal sqrt(vol)*pxy
#variable pxz equal sqrt(vol)*pxz
#variable pyz equal sqrt(vol)*pyz
#variable Nxy equal sqrt(vol)*(pxx-pyy)
#variable Nxz equal sqrt(vol)*(pxx-pzz)
#variable Nyz equal sqrt(vol)*(pyy-pzz)
#fix Gxy all ave/correlate/long 1 100000 v_pxy v_pxz v_pyz v_Nxy v_Nxz v_Nyz type auto file $F.gt overwrite ncorr 40

# NEED PACKAGE MC
# Nevery itype,jtype Rmin bondtype prob seed MAxbond Newtype
fix BondCreate all bond/create/destroy 100 2 2 1.0 2 prob ${pon} ${poff} 44394398 imax 1 jmax 1 Rmin 0.0

thermo 1000
thermo_style custom step temp etotal press bonds f_BondCreate[3] f_BondCreate[4] f_BondCreate[5]
thermo_modify norm no flush yes
dump            coord all custom 10000 $Fpon${pon}Keq${keq}.lammpstrj.gz id xu yu zu
dump_modify coord sort id 

restart 600000 $Fpon${pon}Keq${keq}.restart1.dat $Fpon${pon}Keq${keq}.restart2.dat
reset_timestep 0 
timestep        0.01
run 10000000

write_restart $F.equilibrated_stickers.dat
write_data  $F.equilibrated_stickers.lammpsdat nocoeff

